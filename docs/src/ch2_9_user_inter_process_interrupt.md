# 用户态跨进程中断

注：此部分仍在设计过程中，以下内容为草稿，随时可能变化。

在仅添加寄存器和指令的 N 扩展中，类似信号的跨进程中断机制仍然通过系统调用来实现，每一次发送都需要内核介入，接收方也只有在下一次从内核返回用户态时才能够处理，延迟较长。我们希望加入更多的软硬件支持，以减少延迟和切换开销。

## ACLINT - N

在 RISC-V 特权级规范 v1.11 中，跨核中断只能将目标核的 `mip.MSIP` 位置 1 ，而 `mip.SSIP` 只能由在本核上运行的软件通过 `csrw` 等指令写入，故 S 态的跨核中断也必须由 M 态程序（通常为 SBI ）进行转发。但随着 [ACLINT 规范](https://github.com/riscv/riscv-aclint)提出对 S-IPI 的直接硬件支持，最新特权级规范的草案也在 [commit 01069ac](https://github.com/riscv/riscv-isa-manual/commit/01069ac96b90bdc330fc4471945639a54e3b3b69) 中去除了前述的限制，改为允许平台特定的中断控制器将 `mip.SSIP` 置 1 。

在此基础上，我们认为，可以在 ACLINT 中加入对用户态跨核中断的支持，允许将 `mip.USIP` 直接置 1 ，这样当发送方和接收方恰在两个不同的 hart 上运行时，接收方在用户态下也可以直接收到中断，既无需等到下一次调度，也无需通过 SBI - OS - APP 将中断逐级转发。但发送方难以获知接收方是否在核上运行、在哪一核上运行，发送过程仍然需要内核介入。

## Intel Uintr


